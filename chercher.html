<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chercher un Client</title>
    <!-- Import des styles Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Import des scripts Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        .client-details {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container client-details">
        <h1>Chercher un Client</h1>
        <div id="clientDetails">
            <!-- Les détails du client seront affichés ici -->
        </div>
        <a href="index.html" class="btn btn-primary mt-3">Retour à la liste des clients</a>
    </div>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCSwDwN0kwekR6U0V_FGnEM5JecyKmXWLI",
            authDomain: "haja-d4b91.firebaseapp.com",
            databaseURL: "https://haja-d4b91-default-rtdb.firebaseio.com",
            projectId: "haja-d4b91",
            storageBucket: "haja-d4b91.appspot.com",
            messagingSenderId: "1680817769",
            appId: "1:1680817769:web:c5b0410064c2911e116cf8",
            measurementId: "G-DQEWC6LZPG"
        };

        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Obtenir le CIN depuis l'URL
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        const cin = getQueryParam('cin');

        // Charger les détails du client
        function loadClientDetails() {
            const clientRef = database.ref('patients/' + cin);
            clientRef.once('value', (snapshot) => {
                const data = snapshot.val();
                const detailsDiv = document.getElementById('clientDetails');

                if (data) {
                    const age = calculateAge(data.dateNaissance);
                    detailsDiv.innerHTML = `
                        <h2>Informations du Client</h2>
                        <p><strong>Numéro de CIN:</strong> ${data.cin}</p>
                        <p><strong>Nom:</strong> ${data.nom}</p>
                        <p><strong>Prénom:</strong> ${data.prenom}</p>
                        <p><strong>Date de Naissance:</strong> ${new Date(data.dateNaissance).toLocaleDateString()}</p>
                        <p><strong>Âge:</strong> ${age}</p>
                        <p><strong>Adresse:</strong> ${data.adresse}</p>
                    `;
                } else {
                    detailsDiv.innerHTML = '<p>Client non trouvé.</p>';
                }
            }).catch((error) => {
                console.error('Erreur lors de la récupération des détails du client:', error);
            });
        }

        // Calculer l'âge à partir de la date de naissance
        function calculateAge(dateNaissance) {
            const birthDate = new Date(dateNaissance);
            const ageDifMs = Date.now() - birthDate.getTime();
            const ageDate = new Date(ageDifMs);
            return Math.abs(ageDate.getUTCFullYear() - 1970);
        }

        // Charger les détails du client lors du chargement de la page
        document.addEventListener('DOMContentLoaded', loadClientDetails);
    </script>
</body>
</html>
